https://kbr.symphonyindai.com/wrp/pages/asset/1?navbar=false


email_manager.py

import requests
import os
import json
import uuid
EMAIL_API_URL = "/api/email/template/"

sample_email = {
  "bccAddresses": [
  ],
  "ccAddresses": [
  ],
  "requestData": {
    "paymentAmount": 42,
    "message": "Thank you for purchasing the answer to the universe. We appreciate your business"
  },
  "userIds": [
    "a917768c-71b8-4ff3-a2a3-21cc4de858c4"
  ]
}
forget_password_template_id = "3e3cc524-c37d-4060-b2e1-e8c1b1346ff8"
tenant_id = "48b668ae-6a78-025d-5197-2c336c4ae7cc"
class EmailManager:
    def __init__(self, auth_url=None, auth_api_key=None):
        self.auth_url = auth_url if auth_url is not None else os.environ["AUTH_HOST_INTERNAL"]
        self.auth_api_key = auth_api_key if auth_api_key is not None else os.environ["AUTH_API_KEY"]

    def set_password_by_user(self):
        pass

    def verify_email(self, verification_id):
        url = self.auth_url + '/api/user/verify-email/' + verification_id
        resp = requests.post(url,
                             headers={
                                 'Authorization': self.auth_api_key,
                                 'Content-Type': 'application/json',
                                 'X-FusionAuth-TenantId': tenant_id})
        print(resp)

    def forget_password(self, payload):
        change_password_id = payload.get('change_password_id', None)
        loginId = payload.get('login_id')
        send_forget_password_email = payload.get('send_forget_password_email', False)
        user = payload.get('user', None)

        res_payload = {}
        if change_password_id is not None:
            res_payload['change_password_id'] = change_password_id
        if loginId is not None:
            res_payload['loginId'] = loginId
        if send_forget_password_email:
            res_payload['send_forget_password_email'] = send_forget_password_email
        if user is not None:
            res_payload['user'] = user

        url = self.auth_url + '/api/user/forget-password'
        resp = requests.post(url,json=json.dumps(res_payload),
                             headers={
                                 'Authorization': self.auth_api_key,
                                 'Content-Type': 'application/json',
                                 'X-FusionAuth-TenantId': tenant_id})

        return resp.json()

    def change_password(self, change_password_id, tenant_id, payload):
        url = self.auth_url + '/api/user/change-password/' + change_password_id
        resp = requests.post(url,data=json.dumps(payload),
                             headers={
                                 'Authorization': self.auth_api_key,
                                 'Content-Type': 'application/json',
                                 'X-FusionAuth-TenantId': tenant_id})
        return resp.json()






----------------------------


##Note : 
In the below documentation the fusionauth url
(usually hosted in localhost:19011 of the hosting server) is referenced as 'domain' 


##verify email, forget and change passwords configurations 
Verify email:
* Login to fusionauth 
* Go to Tenants -> Email.
   Give the appropriate details like below example :

    ![Test Image 4](./screenshots/email verify/email_verify_1.png)    
 
    ![Test Image 4](./screenshots/email verify/email_verify_2.png)
        
         Hostname  :smtp.gmail.com
         port : 587 (for TLS), 465 (for SSL)
         User name : xxx@yyy.com (using which you are logging in to 'Hostname' server and send mail)
         Change Password : Give the password of the 'User name' field (using which you are logging in to 'Hostname' server and send mail)   
         security : TLS or SSL
         Verify email : Enble this option to send email once email registered
         Verify email when changed : Enable this option to send mail when the user changes the email  
         Verification template : Choose the Template for Verification Email
         Delete unverified users : Enable this option to Delete Unverified users 
         Template settings : Choose the appropriate template to each template type

##Send email to setup password on registration:
* Login to fusionauth 
* To add new User 
    
        1)  Go to Users -> Click the + button.
    ![Test Image 4](./screenshots/add%20new%20user%20and%20set%20password/add_user_set_password.png)
    
    
        2)  Give the User Details, Tenant Details like below.   
        3)  Enable the 'Send email to setup password'.
        4)  Skip the Two-factor authentication toggle.
        5)  Fill the  'options' details if needed.     
   
   
   
   ![Test Image 4](./screenshots/add%20new%20user%20and%20set%20password/add_user_set_password_2.png)
    
        6)  Click save
   
   ![Test Image 4](./screenshots/add%20new%20user%20and%20set%20password/add_user_set_password_4.png)

* After creating a new user open the mail box and click the   
  link(like above screenshot).
  
  ![Test Image 4](./screenshots/add%20new%20user%20and%20set%20password/add_user_set_password_3.png)

* Enter the 'password' and 'confirm password' in the opened Form and click submit as given in the above form.        

    
##Create New User
*   API for creating new user
        
        API EndPoint : http://{domain}/api/user
        Request Body : {
                        	"user" :
                        	        { 
                        	            "email" : "xxx@yyy.com",
			                            "password" : "yyyy" 
			                        }
                       }

        Headers      : X-FusionAuth-TenantId => <tenant_id>
                       Authorization => <master_api_key>  

##Forgot Password

* From Login Page :
    
    ![Test Image 4](./screenshots/forgot password/forgot_password_.png)
     
     
     1) click the 'Forgot Password' link (shown in above screenshot) 
    
   ![Test Image 4](./screenshots/forgot password/forgot_password_1.png)   
     
     2) The page should open the URL https://{domain}/password/forgot?tenantId=<tenant_id> 
     3) Fill in the registered email address and click submit (shown in above screenshot)
   
   ![Test Image 4](./screenshots/forgot password/forgot_password_2.png)   
    
     4) Check the mail box, you will find the change password URL, click that link.
     
   ![Test Image 4](./screenshots/forgot password/forgot_password_3.png)   
   
     5) In the change password form, fill the passwords and click submit. 
     
* API for triggering Forgot Password : 

        API URL : http:/{domain}/api/user/forgot-password/
                  (domain should be localhost:19011 in case of fusionauth running locally)
        
        Request Body : 
                    {
	                        "loginId" : "xxx@yyy.com"
                    }
        API Headers :   
                    X-FusionAuth-TenantId : <tenant_id>
                    Content-Type :  application/json 
                    Authorization : <master-api-key>
                            
    

















